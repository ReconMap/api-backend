<?php declare(strict_types=1);

namespace Reconmap\Database;


use Reconmap\Models\Vulnerability;
use Reconmap\Repositories\VulnerabilityRepository;

class VulnerabilityTestDataGenerator
{
    public function __construct(private readonly VulnerabilityRepository $vulnerabilityRepository)
    {
    }

    public function run(): void
    {
        $risks = ['none', 'low', 'medium', 'high', 'critical'];

        for ($i = 0; $i < 100; $i++) {
            $vulnerability = new Vulnerability();
            $vulnerability->project_id = 2;
            $vulnerability->target_id = 1;
            $vulnerability->creator_uid = 1;
            $vulnerability->category_id = rand(1, 12);
            $vulnerability->summary = "Test vulnerability #$i";
            $vulnerability->risk = $risks[array_rand($risks)];
            $vulnerability->cvss_score = rand(0, 100) / 10;
            $vulnerability->cvss_vector = 'CVSS:3.0/AV:P/AC:H/PR:H/UI:R/S:C/C:H/I:H/A:H';
            $vulnerability->status = 'open';
            $vulnerability->substatus = 'reported';
            $vulnerability->tags = json_encode(['test', 'tag']);
            $vulnerability->is_template = $i === 54;
            $this->vulnerabilityRepository->insert($vulnerability);
        }
    }
}
