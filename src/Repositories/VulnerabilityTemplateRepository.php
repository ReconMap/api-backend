<?php declare(strict_types=1);

namespace Reconmap\Repositories;

use Ponup\SqlBuilders\SelectQueryBuilder;

class VulnerabilityTemplateRepository extends VulnerabilityRepository
{
    protected function getBaseSelectQueryBuilder(): SelectQueryBuilder
    {
        $queryBuilder = new SelectQueryBuilder('vulnerability_template v');
        $queryBuilder->setColumns('
            v.id, v.insert_ts, v.update_ts, v.summary, v.description, v.proof_of_concept, v.impact, v.remediation, v.risk, v.cvss_score, v.cvss_vector, v.tags,
            v.category_id, vc.name AS category_name,
            v.creator_uid, u.full_name AS creator_full_name,
            v.owasp_vector, v.owasp_likehood, v.owasp_impact, v.owasp_overall
        ');
        $queryBuilder->addJoin('INNER JOIN user u ON (u.id = v.creator_uid)');
        $queryBuilder->addJoin('LEFT JOIN vulnerability_category vc ON (vc.id = v.category_id)');
        $queryBuilder->setOrderBy('v.insert_ts DESC, v.summary ASC');
        return $queryBuilder;
    }
}
